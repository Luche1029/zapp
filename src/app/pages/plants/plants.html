<div class="page-wrapper">

  <!-- Lista piante -->
  <div class="module-container" [class.hidden]="selectedPlant">
    
      <h2>Le tue piante</h2>
      <button class="open-calendar-button" (click)="goToCalendar(0)" title="Calendario">
        <span class="material-icons">calendar_month</span>
      </button>
  

    <div *ngIf="loading">Caricamento in corso...</div>
    <div *ngIf="error" class="error">{{ error }}</div>

    <ul *ngIf="!loading && !error">
      <li *ngFor="let plant of plants; let i = index"
          [class.active]="i === selectedIndex"
          (click)="selectPlant(i)">
        <strong>{{ plant.nickname }}</strong>
        <span>({{ plant.species_name }})</span>
      </li>
    </ul>

    <button class="add-button" (click)="openAddPlantForm()">
      <span class="material-icons">add</span>
    </button>
  </div>

  <!-- Dettaglio pianta -->
  <div class="module-container" *ngIf="selectedPlant">
    <header>
    <h2>{{ selectedPlant.nickname }} <small *ngIf="selectedPlant.common_name">({{ selectedPlant.common_name }})</small></h2>
    <img *ngIf="selectedPlant.image_url" [src]="selectedPlant.image_url" alt="{{ selectedPlant.common_name }}" />
    </header>
    <ul>     
      <li><strong>Nome scientifico:</strong> {{ selectedPlant.scientific_name }}</li>
      <li><strong>Categoria:</strong> {{ selectedPlant.category_name }}</li>
      <li><strong>Esposizione:</strong> {{ selectedPlant.sun_exposure_name }}</li>

      <li><strong>Status:</strong> {{ selectedPlant.status_name }}</li>
      <li><strong>Data impianto:</strong> {{ selectedPlant.planted_date | date }}</li>
      <li><strong>Ultima annaffiatura:</strong> {{ selectedPlant.last_watering | date }}</li>
      <li><strong>Posizione:</strong> {{ selectedPlant.location }}</li>

      <li><strong>Note:</strong> {{ selectedPlant.plant_notes || selectedPlant.species_notes }}</li>
    </ul>
    


    <button class="open-calendar-button" (click)="goToTasks()">
      <span class="material-icons">pending_actions</span>
    </button>

    <!-- Pulsante torna alla lista per mobile -->
    <button class="back-button" (click)="deselectPlant()">
      <span class="material-icons">arrow_left</span>
    </button>
  </div>

  <button class="fab" (click)="goToSpecies()">
     <span class="material-icons">eco</span>
  </button>

  <!-- Modal aggiunta pianta -->
  <div class="modal" *ngIf="showAddModal">
    <div class="modal-content">
      <h3>Aggiungi pianta</h3>
      <form (ngSubmit)="addPlant()" #plantForm="ngForm">
        <label>Specie</label>
        <select [(ngModel)]="newPlant.species_id" name="species_id" required>
          <option *ngFor="let s of species" [value]="s.id">{{ s.common_name }}</option>
        </select>

        <label>Nickname</label>
        <input type="text" [(ngModel)]="newPlant.nickname" name="nickname" required />

        <label>Data impianto</label>
        <input type="date" [(ngModel)]="newPlant.planted_date" name="planted_date" required />

        <label>Status</label>
        <select [(ngModel)]="newPlant.status" name="status">
          <option *ngFor="let s of status" [value]="s.id">{{s.name}}</option>
         
        </select>

        <label>Posizione</label>
        <input type="text" [(ngModel)]="newPlant.location" name="location" />

        <button type="submit" [disabled]="!plantForm.valid">Salva</button>
        <button type="button" (click)="closeAddPlantForm()">Annulla</button>
      </form>
    </div>
  </div>
</div>



